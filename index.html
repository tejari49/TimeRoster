<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeRoster - Modern Shift & Time Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --secondary-light: #34d399;
            --accent: #f59e0b;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-main);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: var(--bg-card);
            padding: 0;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 20px 30px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-width: 120px;
        }

        .nav-tab:hover {
            background: var(--bg-main);
            color: var(--primary);
        }

        .nav-tab.active {
            color: var(--primary);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }

        .content {
            padding: 40px;
        }

        .module {
            display: none;
        }

        .module.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .list-item {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .list-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .list-item-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .list-item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.875rem;
            border-radius: 6px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 12px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: var(--primary-light);
            color: white;
            transform: scale(1.05);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: 700;
        }

        .calendar-day.has-event {
            border: 2px solid var(--accent);
        }

        .calendar-header {
            font-weight: 700;
            color: var(--primary);
            padding: 12px;
        }

        .shift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .shift-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .shift-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .shift-card h4 {
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .shift-time {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 12px 0;
        }

        .time-tracker {
            text-align: center;
            padding: 40px;
        }

        .time-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 10px 0;
        }

        .status-active {
            background: var(--secondary-light);
            color: #065f46;
        }

        .status-inactive {
            background: #fca5a5;
            color: #991b1b;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-main);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .todo-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .todo-text {
            flex: 1;
            font-size: 1rem;
        }

        .todo-completed {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .nav-tab {
                padding: 15px 10px;
                font-size: 0.9rem;
            }

            .calendar-grid {
                gap: 4px;
            }

            .time-display {
                font-size: 2rem;
            }

            .stat-value {
                font-size: 2rem;
            }
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚è∞ TimeRoster</h1>
            <p>Your modern shift and time management companion</p>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showModule('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showModule('calendar')">üìÖ Calendar</button>
            <button class="nav-tab" onclick="showModule('shifts')">üîÑ Shifts</button>
            <button class="nav-tab" onclick="showModule('timetrack')">‚è±Ô∏è Time Track</button>
            <button class="nav-tab" onclick="showModule('todos')">‚úì TODOs</button>
            <button class="nav-tab" onclick="showModule('settings')">‚öôÔ∏è Settings</button>
        </nav>

        <div class="content">
            <!-- Dashboard Module -->
            <div id="dashboard" class="module active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-events">0</div>
                        <div class="stat-label">Calendar Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-shifts">0</div>
                        <div class="stat-label">Active Shifts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-todos">0</div>
                        <div class="stat-label">TODOs</div>
                    </div>
                </div>

                <div class="card">
                    <h2>üëã Welcome to TimeRoster!</h2>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        Manage your time effectively with our modern and friendly interface. 
                        Track your shifts, manage events, log your work hours, and keep organized with our TODO list.
                    </p>
                </div>

                <div class="card">
                    <h3>Quick Actions</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="showModule('calendar'); openModal('addEventModal')">
                            ‚ûï Add Event
                        </button>
                        <button class="btn btn-secondary" onclick="showModule('shifts'); openModal('addShiftModal')">
                            üîÑ Add Shift
                        </button>
                        <button class="btn btn-outline" onclick="showModule('todos')">
                            ‚úì View TODOs
                        </button>
                    </div>
                </div>
            </div>

            <!-- Calendar Module -->
            <div id="calendar" class="module">
                <div class="card">
                    <h2>üìÖ Calendar</h2>
                    <button class="btn btn-primary" onclick="openModal('addEventModal')">‚ûï Add Event</button>
                    
                    <div class="calendar-grid" style="margin-top: 20px;">
                        <div class="calendar-header">Sun</div>
                        <div class="calendar-header">Mon</div>
                        <div class="calendar-header">Tue</div>
                        <div class="calendar-header">Wed</div>
                        <div class="calendar-header">Thu</div>
                        <div class="calendar-header">Fri</div>
                        <div class="calendar-header">Sat</div>
                    </div>
                    <div id="calendarDays" class="calendar-grid"></div>
                </div>

                <div class="card">
                    <h3>Upcoming Events</h3>
                    <div id="eventsList"></div>
                </div>
            </div>

            <!-- Shifts Module -->
            <div id="shifts" class="module">
                <div class="card">
                    <h2>üîÑ Shift Plan</h2>
                    <button class="btn btn-primary" onclick="openModal('addShiftModal')">‚ûï Add Shift</button>
                    
                    <div class="shift-grid" id="shiftsList"></div>
                </div>
            </div>

            <!-- Time Tracking Module -->
            <div id="timetrack" class="module">
                <div class="card time-tracker">
                    <h2>‚è±Ô∏è Time Tracking</h2>
                    <div class="time-display" id="currentTime">00:00:00</div>
                    <div>
                        <span class="status-badge" id="trackingStatus">Status: Not Tracking</span>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="btn btn-secondary btn-large" id="clockInBtn" onclick="clockIn()">
                            ‚ñ∂Ô∏è Clock In
                        </button>
                        <button class="btn btn-danger btn-large" id="clockOutBtn" onclick="clockOut()" style="display: none;">
                            ‚è∏Ô∏è Clock Out
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>Time Log History</h3>
                    <div id="timeLogList"></div>
                </div>
            </div>

            <!-- TODOs Module -->
            <div id="todos" class="module">
                <div class="card">
                    <h2>‚úì TODO List</h2>
                    <div class="input-group">
                        <input type="text" id="todoInput" placeholder="What needs to be done?" 
                               onkeypress="if(event.key === 'Enter') addTodo()">
                    </div>
                    <button class="btn btn-primary" onclick="addTodo()">‚ûï Add TODO</button>
                    
                    <div id="todosList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Settings Module -->
            <div id="settings" class="module">
                <div class="card">
                    <h2>‚öôÔ∏è Settings & Data Management</h2>
                    
                    <h3>Export Data</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                        Download all your data as a JSON file for backup.
                    </p>
                    <button class="btn btn-primary" onclick="exportData()">
                        üíæ Export All Data
                    </button>

                    <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--border);">

                    <h3>Import Data</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                        Import data from a previously exported JSON file.
                    </p>
                    <input type="file" id="importFile" accept=".json" style="margin-bottom: 16px;">
                    <button class="btn btn-secondary" onclick="importData()">
                        üìÇ Import Data
                    </button>

                    <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--border);">

                    <h3>Clear All Data</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 16px;">
                        ‚ö†Ô∏è This will permanently delete all your data. This action cannot be undone.
                    </p>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        üóëÔ∏è Clear All Data
                    </button>
                </div>

                <div class="card">
                    <h3>About TimeRoster</h3>
                    <p style="color: var(--text-secondary); line-height: 1.6;">
                        Version 1.0.0<br>
                        A modern and friendly time and shift management application.<br>
                        All data is stored locally in your browser.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Calendar Event</h3>
                <button class="close-modal" onclick="closeModal('addEventModal')">‚úï</button>
            </div>
            <div class="input-group">
                <label>Event Title</label>
                <input type="text" id="eventTitle" placeholder="e.g., Team Meeting">
            </div>
            <div class="input-group">
                <label>Date</label>
                <input type="date" id="eventDate">
            </div>
            <div class="input-group">
                <label>Time</label>
                <input type="time" id="eventTime">
            </div>
            <div class="input-group">
                <label>Description (Optional)</label>
                <textarea id="eventDescription" rows="3" placeholder="Add details..."></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="addEvent()">Add Event</button>
                <button class="btn btn-outline" onclick="closeModal('addEventModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Shift Modal -->
    <div id="addShiftModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Shift</h3>
                <button class="close-modal" onclick="closeModal('addShiftModal')">‚úï</button>
            </div>
            <div class="input-group">
                <label>Shift Name</label>
                <input type="text" id="shiftName" placeholder="e.g., Morning Shift">
            </div>
            <div class="form-row">
                <div class="input-group">
                    <label>Start Date</label>
                    <input type="date" id="shiftStartDate">
                </div>
                <div class="input-group">
                    <label>End Date</label>
                    <input type="date" id="shiftEndDate">
                </div>
            </div>
            <div class="form-row">
                <div class="input-group">
                    <label>Start Time</label>
                    <input type="time" id="shiftStartTime">
                </div>
                <div class="input-group">
                    <label>End Time</label>
                    <input type="time" id="shiftEndTime">
                </div>
            </div>
            <div class="input-group">
                <label>Notes (Optional)</label>
                <textarea id="shiftNotes" rows="2" placeholder="Add notes..."></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="addShift()">Add Shift</button>
                <button class="btn btn-outline" onclick="closeModal('addShiftModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        const Storage = {
            get(key) {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch {
                    return [];
                }
            },
            set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            },
            clear() {
                localStorage.clear();
            }
        };

        // Initialize
        let events = Storage.get('events');
        let shifts = Storage.get('shifts');
        let todos = Storage.get('todos');
        let timeLogs = Storage.get('timeLogs');
        let trackingSession = Storage.get('trackingSession')[0] || null;

        // Module Navigation
        function showModule(moduleName) {
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(moduleName).classList.add('active');
            event.target.classList.add('active');

            // Refresh content when switching modules
            if (moduleName === 'calendar') renderCalendar();
            if (moduleName === 'shifts') renderShifts();
            if (moduleName === 'todos') renderTodos();
            if (moduleName === 'timetrack') renderTimeLogs();
            if (moduleName === 'dashboard') updateDashboard();
        }

        // Modal Management
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Calendar Functions
        function renderCalendar() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            // Empty cells before first day
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                calendarDays.appendChild(emptyDay);
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                if (events.some(e => e.date === dateStr)) {
                    dayDiv.classList.add('has-event');
                }
                
                if (day === today.getDate()) {
                    dayDiv.classList.add('today');
                }
                
                calendarDays.appendChild(dayDiv);
            }

            renderEventsList();
        }

        function renderEventsList() {
            const eventsList = document.getElementById('eventsList');
            if (events.length === 0) {
                eventsList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>No events yet. Add your first event!</p></div>';
                return;
            }

            const sortedEvents = [...events].sort((a, b) => 
                new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time)
            );

            eventsList.innerHTML = sortedEvents.map((event, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">${event.title}</div>
                        <div class="list-item-subtitle">
                            üìÖ ${new Date(event.date).toLocaleDateString()} at ${event.time}
                            ${event.description ? '<br>' + event.description : ''}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-danger btn-small" onclick="deleteEvent(${index})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;

            if (!title || !date || !time) {
                alert('Please fill in all required fields');
                return;
            }

            events.push({ title, date, time, description, id: Date.now() });
            Storage.set('events', events);
            
            closeModal('addEventModal');
            renderCalendar();
            updateDashboard();
            
            // Clear form
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
        }

        function deleteEvent(index) {
            if (confirm('Delete this event?')) {
                events.splice(index, 1);
                Storage.set('events', events);
                renderEventsList();
                renderCalendar();
                updateDashboard();
            }
        }

        // Shift Functions
        function renderShifts() {
            const shiftsList = document.getElementById('shiftsList');
            if (shifts.length === 0) {
                shiftsList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîÑ</div><p>No shifts scheduled. Add your first shift!</p></div>';
                return;
            }

            shiftsList.innerHTML = shifts.map((shift, index) => `
                <div class="shift-card">
                    <h4>${shift.name}</h4>
                    <div class="shift-time">
                        ${shift.startTime} - ${shift.endTime}
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">
                        üìÖ ${new Date(shift.startDate).toLocaleDateString()} - ${new Date(shift.endDate).toLocaleDateString()}
                    </div>
                    ${shift.notes ? `<div style="margin-top: 12px; font-size: 0.9rem;">${shift.notes}</div>` : ''}
                    <button class="btn btn-danger btn-small" onclick="deleteShift(${index})" 
                            style="margin-top: 16px; width: 100%;">
                        Delete
                    </button>
                </div>
            `).join('');
        }

        function addShift() {
            const name = document.getElementById('shiftName').value;
            const startDate = document.getElementById('shiftStartDate').value;
            const endDate = document.getElementById('shiftEndDate').value;
            const startTime = document.getElementById('shiftStartTime').value;
            const endTime = document.getElementById('shiftEndTime').value;
            const notes = document.getElementById('shiftNotes').value;

            if (!name || !startDate || !endDate || !startTime || !endTime) {
                alert('Please fill in all required fields');
                return;
            }

            shifts.push({ name, startDate, endDate, startTime, endTime, notes, id: Date.now() });
            Storage.set('shifts', shifts);
            
            closeModal('addShiftModal');
            renderShifts();
            updateDashboard();
            
            // Clear form
            document.getElementById('shiftName').value = '';
            document.getElementById('shiftStartDate').value = '';
            document.getElementById('shiftEndDate').value = '';
            document.getElementById('shiftStartTime').value = '';
            document.getElementById('shiftEndTime').value = '';
            document.getElementById('shiftNotes').value = '';
        }

        function deleteShift(index) {
            if (confirm('Delete this shift?')) {
                shifts.splice(index, 1);
                Storage.set('shifts', shifts);
                renderShifts();
                updateDashboard();
            }
        }

        // Time Tracking Functions
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            document.getElementById('currentTime').textContent = timeStr;
        }

        function clockIn() {
            if (trackingSession) {
                alert('Already clocked in!');
                return;
            }

            trackingSession = {
                startTime: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };
            Storage.set('trackingSession', [trackingSession]);

            document.getElementById('clockInBtn').style.display = 'none';
            document.getElementById('clockOutBtn').style.display = 'inline-flex';
            document.getElementById('trackingStatus').textContent = 'Status: Tracking';
            document.getElementById('trackingStatus').className = 'status-badge status-active';
        }

        function clockOut() {
            if (!trackingSession) {
                alert('Not clocked in!');
                return;
            }

            const endTime = new Date();
            const startTime = new Date(trackingSession.startTime);
            const duration = Math.floor((endTime - startTime) / 1000 / 60); // minutes

            timeLogs.push({
                date: trackingSession.date,
                startTime: startTime.toLocaleTimeString(),
                endTime: endTime.toLocaleTimeString(),
                duration: duration,
                id: Date.now()
            });
            Storage.set('timeLogs', timeLogs);

            trackingSession = null;
            Storage.set('trackingSession', []);

            document.getElementById('clockInBtn').style.display = 'inline-flex';
            document.getElementById('clockOutBtn').style.display = 'none';
            document.getElementById('trackingStatus').textContent = 'Status: Not Tracking';
            document.getElementById('trackingStatus').className = 'status-badge status-inactive';

            renderTimeLogs();
        }

        function renderTimeLogs() {
            const timeLogList = document.getElementById('timeLogList');
            if (timeLogs.length === 0) {
                timeLogList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è±Ô∏è</div><p>No time logs yet. Clock in to start tracking!</p></div>';
                return;
            }

            const sortedLogs = [...timeLogs].reverse();
            timeLogList.innerHTML = sortedLogs.map((log, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">${log.date}</div>
                        <div class="list-item-subtitle">
                            ${log.startTime} ‚Üí ${log.endTime} (${log.duration} minutes)
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-danger btn-small" onclick="deleteTimeLog(${timeLogs.length - 1 - index})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteTimeLog(index) {
            if (confirm('Delete this time log?')) {
                timeLogs.splice(index, 1);
                Storage.set('timeLogs', timeLogs);
                renderTimeLogs();
            }
        }

        // TODO Functions
        function renderTodos() {
            const todosList = document.getElementById('todosList');
            if (todos.length === 0) {
                todosList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úì</div><p>No todos yet. Add your first task!</p></div>';
                return;
            }

            todosList.innerHTML = todos.map((todo, index) => `
                <div class="todo-item">
                    <input type="checkbox" class="todo-checkbox" 
                           ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${index})">
                    <div class="todo-text ${todo.completed ? 'todo-completed' : ''}">
                        ${todo.text}
                    </div>
                    <button class="btn btn-danger btn-small" onclick="deleteTodo(${index})">Delete</button>
                </div>
            `).join('');
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (!text) {
                alert('Please enter a todo item');
                return;
            }

            todos.push({ text, completed: false, id: Date.now() });
            Storage.set('todos', todos);
            
            input.value = '';
            renderTodos();
            updateDashboard();
        }

        function toggleTodo(index) {
            todos[index].completed = !todos[index].completed;
            Storage.set('todos', todos);
            renderTodos();
            updateDashboard();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            Storage.set('todos', todos);
            renderTodos();
            updateDashboard();
        }

        // Dashboard Functions
        function updateDashboard() {
            document.getElementById('stat-events').textContent = events.length;
            document.getElementById('stat-shifts').textContent = shifts.length;
            document.getElementById('stat-todos').textContent = todos.filter(t => !t.completed).length;
        }

        // Data Management
        function exportData() {
            const data = {
                events,
                shifts,
                todos,
                timeLogs,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `timeroster-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Continue?')) {
                        events = data.events || [];
                        shifts = data.shifts || [];
                        todos = data.todos || [];
                        timeLogs = data.timeLogs || [];
                        
                        Storage.set('events', events);
                        Storage.set('shifts', shifts);
                        Storage.set('todos', todos);
                        Storage.set('timeLogs', timeLogs);
                        
                        alert('Data imported successfully!');
                        updateDashboard();
                        fileInput.value = '';
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will permanently delete ALL data. Are you sure?')) {
                if (confirm('This action cannot be undone. Really delete everything?')) {
                    Storage.clear();
                    events = [];
                    shifts = [];
                    todos = [];
                    timeLogs = [];
                    trackingSession = null;
                    
                    alert('All data has been cleared');
                    updateDashboard();
                    renderCalendar();
                    renderShifts();
                    renderTodos();
                    renderTimeLogs();
                }
            }
        }

        // Initialize on load
        window.onload = function() {
            updateClock();
            setInterval(updateClock, 1000);
            
            renderCalendar();
            renderShifts();
            renderTodos();
            renderTimeLogs();
            updateDashboard();

            // Restore tracking session if exists
            if (trackingSession) {
                document.getElementById('clockInBtn').style.display = 'none';
                document.getElementById('clockOutBtn').style.display = 'inline-flex';
                document.getElementById('trackingStatus').textContent = 'Status: Tracking';
                document.getElementById('trackingStatus').className = 'status-badge status-active';
            }

            // Set default dates for forms
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('eventDate').value = today;
            document.getElementById('shiftStartDate').value = today;
            document.getElementById('shiftEndDate').value = today;
        };
    </script>
</body>
</html>
